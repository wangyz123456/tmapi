<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.tmapi.dao.master.PurchaseItemBakDao">

    <select id="querySumAmountTodayById" resultType="com.example.tmapi.entity.PurchaseItemBak" parameterType="com.example.tmapi.entity.PurchaseItemBak" >
        SELECT SUM (Amount) TodaySumAmount
        FROM
        purchaseItemBak p
        LEFT JOIN POSSeller s ON p.SellerID = s.SellerName
        WHERE
        1 = 1
        <if test="purchaseItemBak.StoreId != null">
            and p.StoreId = #{purchaseItemBak.StoreId}
        </if>
        <if test="purchaseItemBak.StoreId != null">
            and s.StoreId = #{purchaseItemBak.StoreId}
        </if>
        <if test="purchaseItemBak.SellerID != null">
            and s.SellerID = #{purchaseItemBak.SellerID}
        </if>
        <if test="purchaseItemBak.startDate != null">
            and p.BuyDate = #{purchaseItemBak.startDate}
        </if>


    </select>


    <select id="queryByStoreId" resultType="com.example.tmapi.entity.PurchaseItemBak" parameterType="com.example.tmapi.entity.PurchaseItemBak">
        SELECT
            StoreId,
            SUM(Amount) as TodaySumAmount,
            sum(Qty * StockPrice) as SaleCost,
            sum(Amount-Qty * StockPrice) as sumProfit

        FROM
            PurchaseItemBak
        WHERE 1=1
        <if test="purchaseItemBak.startDate != null">
            and  BuyDate = #{purchaseItemBak.startDate}
        </if>
        <if test="purchaseItemBak.StoreId != null">
            and StoreID = #{purchaseItemBak.StoreId}
        </if>
        <if test="purchaseItemBak.SellerID != null">
            and  SellerID = #{purchaseItemBak.SellerID}
        </if>
        GROUP BY
            StoreID

    </select>


    <select id="queryByDate"  resultType="com.example.tmapi.entity.PurchaseItemBak" parameterType="com.example.tmapi.entity.PurchaseItemBak">
        SELECT
          StoreID,
          GoodsID,
            SUM (qty) qty

        FROM
            PurchaseItemBak
        where  BuyDate >= #{purchaseItemBak.startDate}
        GROUP BY StoreID,GoodsID
    </select>


    <select id="queryByDateTime"  resultType="com.example.tmapi.entity.PurchaseItemBak" parameterType="com.example.tmapi.entity.PurchaseItemBak">
       SELECT
            i.StoreID,
            s.StoreName as StoreName,
            i.GoodsID,
            LEFT(g.Name,8)as Name,
            i.SellerID,
            i.Qty,
            i.Price,
            i.Amount,
            i.BuyDate,
            p.BuyTime as BuyTime
        FROM
            PurchaseItemBak i,
            PurchaseBak p,
            Goods g,
            Stores s
        where i.StoreID = p.StoreID
         and i.BuyDate = p.BuyDate
        and i.MachID = p.MachID
        and i.ReceiptID = p.ReceiptID
        and i.Qty>0
        and i.StoreID = s.StoreID
        and i.GoodsID = g.GoodsID
        and p.BuyDate= #{purchaseItemBak.startDate}
        and p.BuyTime >= #{purchaseItemBak.startTime}
        ORDER BY i.StoreID
    </select>
</mapper>